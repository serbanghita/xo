/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/Game.ts":
/*!*********************!*\
  !*** ./src/Game.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.GameResult = exports.Player = void 0;
const utils_1 = __webpack_require__(/*! ./utils */ "./src/utils.ts");
var Player;
(function (Player) {
    Player[Player["NONE"] = 0] = "NONE";
    Player[Player["X"] = 1] = "X";
    Player[Player["O"] = 2] = "O";
})(Player = exports.Player || (exports.Player = {}));
var GameResult;
(function (GameResult) {
    GameResult[GameResult["PLAYING"] = 0] = "PLAYING";
    GameResult[GameResult["WIN"] = 1] = "WIN";
    GameResult[GameResult["DRAW"] = 2] = "DRAW";
})(GameResult = exports.GameResult || (exports.GameResult = {}));
class Game {
    constructor(onStart, onBeforeMove, onAfterMove, onFinish) {
        this.onStart = onStart;
        this.onBeforeMove = onBeforeMove;
        this.onAfterMove = onAfterMove;
        this.onFinish = onFinish;
        // Game state.
        this.state = {
            boardMatrix: this.cloneBoard(),
            roundMovesPerIndex: [],
            roundMovesPerPlayer: {
                [Player.X]: [],
                [Player.O]: []
            },
            winner: "",
            winningTiles: [],
            currentPlayer: Player.X,
            result: GameResult.PLAYING
        };
        this.onStart = onStart === null || onStart === void 0 ? void 0 : onStart.bind(this);
        this.onBeforeMove = onBeforeMove === null || onBeforeMove === void 0 ? void 0 : onBeforeMove.bind(this);
        this.onAfterMove = onAfterMove === null || onAfterMove === void 0 ? void 0 : onAfterMove.bind(this);
        this.onFinish = onFinish === null || onFinish === void 0 ? void 0 : onFinish.bind(this);
    }
    cloneBoard() {
        return Game.BOARD_MATRIX.slice(0).map((row) => {
            return row.slice(0);
        });
    }
    drawStartButton() {
        const elem = document.createElement("button");
        elem.style.display = "absolute";
        elem.innerText = "Re-start game";
        elem.style.marginTop = "1em";
        elem.style.userSelect = "none";
        elem.style.cursor = "pointer";
        this.$startBtn = elem;
        this.$canvas.appendChild(this.$startBtn);
    }
    drawAnnouncements(text) {
        const elem = document.createElement("div");
        elem.style.display = "absolute";
        elem.style.padding = "1em";
        elem.style.fontStyle = "italics";
        elem.innerText = text;
        this.$announcements = elem;
        this.$canvas.appendChild(this.$announcements);
    }
    removeAnnouncements() {
        return this.$announcements && this.$announcements.remove();
    }
    drawCanvas() {
        this.$canvas = document.createElement("div");
        this.$canvas.style.boxSizing = "border-box";
        this.$canvas.style.textAlign = "center";
        this.$canvas.style.position = "relative";
        this.$canvas.id = "canvas";
        this.$canvas.style.width = `${Game.BOARD_BOX_SIZE * Game.BOARD_SIZE}px`;
        this.$canvas.style.height = `${Game.BOARD_BOX_SIZE * Game.BOARD_SIZE}px`;
        for (let i = 0; i < Game.BOARD_SIZE * Game.BOARD_SIZE; i++) {
            const $box = document.createElement("div");
            $box.style.float = "left";
            $box.style.width = `${Game.BOARD_BOX_SIZE}px`;
            $box.style.height = `${Game.BOARD_BOX_SIZE}px`;
            $box.style.lineHeight = `${Game.BOARD_BOX_SIZE}px`;
            $box.style.border = "1px solid black";
            $box.style.boxShadow = "0 0 0 1px black";
            $box.style.boxSizing = "border-box";
            $box.style.fontSize = `${Game.BOARD_BOX_SIZE / 2}px`;
            $box.style.cursor = "pointer";
            $box.style.userSelect = "none";
            $box.id = `box-${i}`;
            $box.dataset.index = `${i}`;
            $box.dataset.row = `${Math.floor(i / Game.BOARD_SIZE)}`;
            $box.dataset.column = `${i % Game.BOARD_SIZE}`;
            $box.className = "box";
            this.$canvas.appendChild($box);
        }
        document.body.appendChild(this.$canvas);
    }
    bindEvents() {
        this.$canvas.addEventListener('click', (e) => {
            if (this.onBeforeMove) {
                this.onBeforeMove();
            }
            this.onBoardBoxClick.bind(this)(e);
            // Only execute the next callback if the game is not finished.
            if (this.state.result === GameResult.PLAYING && this.onAfterMove) {
                this.onAfterMove();
            }
        });
        this.$startBtn.addEventListener('click', () => {
            this.reset();
            this.resetRender();
        });
    }
    onBoardBoxClick(e) {
        const $box = e.target;
        // Prevent propagating click callback if:
        // 1. the DOM element clicked is not a "box".
        // 2. the "box" already has a value in it.
        // 3. A player already won the game.
        if ($box.className !== "box" || $box.innerText !== "" || this.state.result !== GameResult.PLAYING) {
            return false;
        }
        const index = parseInt($box.dataset.index, 10);
        const row = parseInt($box.dataset.row, 10);
        const column = parseInt($box.dataset.column, 10);
        // Store round moves.
        this.state.roundMovesPerPlayer[this.state.currentPlayer].push(index);
        this.state.roundMovesPerIndex.push(index);
        this.state.boardMatrix[row][column] = this.state.currentPlayer;
        $box.innerText = this.getCurrentPlayerLabel();
        const result = this.checkGameResult();
        if ([GameResult.WIN, GameResult.DRAW].includes(result)) {
            if (result === GameResult.WIN) {
                this.state.winningTiles.forEach((tileArr) => {
                    document.querySelector(`[data-row="${tileArr[0]}"][data-column="${tileArr[1]}"]`).style.backgroundColor = "red";
                });
                this.drawAnnouncements(`${this.state.winner} has won!`);
            }
            else if (result === GameResult.DRAW) {
                this.drawAnnouncements(`It's a draw!`);
            }
            if (this.onFinish) {
                this.onFinish();
            }
        }
        // Switch to the next player.
        if (this.state.currentPlayer === Player.X) {
            this.state.currentPlayer = Player.O;
        }
        else {
            this.state.currentPlayer = Player.X;
        }
    }
    // Methodology: brute check all rows and columns and diagonals.
    checkGameResult() {
        // Don't perform winning check until at least 5 moves.
        // 5 moves mean that X has moved 3 times and O only 2 times.
        if (this.state.roundMovesPerIndex.length < ((Game.BOARD_SIZE * 2) - 1)) {
            return GameResult.PLAYING;
        }
        for (let i = 0; i < Game.BOARD_SIZE; i++) {
            // Check rows.
            const rows = utils_1.unique(this.state.boardMatrix[i]);
            if (rows.length === 1 && rows[0] !== Player.NONE) {
                this.state.winner = this.getCurrentPlayerLabel();
                this.state.winningTiles = [[i, 0], [i, 1], [i, 2]];
                this.state.result = GameResult.WIN;
                return GameResult.WIN;
            }
            // Check columns.
            const columns = utils_1.unique([this.state.boardMatrix[0][i], this.state.boardMatrix[1][i], this.state.boardMatrix[2][i]]);
            if (columns.length === 1 && columns[0] !== Player.NONE) {
                this.state.winner = this.getCurrentPlayerLabel();
                this.state.winningTiles = [[0, i], [1, i], [2, i]];
                this.state.result = GameResult.WIN;
                return GameResult.WIN;
            }
        }
        // Check diags.
        const diag1 = utils_1.unique([this.state.boardMatrix[0][0], this.state.boardMatrix[1][1], this.state.boardMatrix[2][2]]);
        if (diag1.length === 1 && diag1[0] !== Player.NONE) {
            this.state.winner = this.getCurrentPlayerLabel();
            this.state.winningTiles = [[0, 0], [1, 1], [2, 2]];
            this.state.result = GameResult.WIN;
            return GameResult.WIN;
        }
        const diag2 = utils_1.unique([this.state.boardMatrix[0][2], this.state.boardMatrix[1][1], this.state.boardMatrix[2][0]]);
        if (diag2.length === 1 && diag2[0] !== Player.NONE) {
            this.state.winner = this.getCurrentPlayerLabel();
            this.state.winningTiles = [[0, 2], [1, 1], [2, 0]];
            this.state.result = GameResult.WIN;
            return GameResult.WIN;
        }
        if (this.state.roundMovesPerIndex.length === Game.BOARD_SIZE * Game.BOARD_SIZE) {
            this.state.result = GameResult.DRAW;
            return GameResult.DRAW;
        }
        return GameResult.PLAYING;
    }
    getCurrentPlayerLabel() {
        return this.state.currentPlayer === Player.X ? "X" : "O";
    }
    start() {
        this.reset();
        this.drawCanvas();
        this.drawStartButton();
        this.bindEvents();
        if (this.onStart) {
            this.onStart();
        }
    }
    reset() {
        this.state.winner = "";
        this.state.winningTiles = [];
        this.state.roundMovesPerIndex = [];
        this.state.roundMovesPerPlayer = {
            [Player.X]: [],
            [Player.O]: []
        };
        this.state.currentPlayer = Player.X;
        this.state.boardMatrix = this.cloneBoard();
        this.state.result = GameResult.PLAYING;
    }
    resetRender() {
        this.removeAnnouncements();
        this.$canvas.querySelectorAll(".box").forEach(($box) => {
            $box.innerText = "";
            $box.style.backgroundColor = "";
        });
    }
}
exports.default = Game;
// Settings.
Game.BOARD_SIZE = 3;
Game.BOARD_BOX_SIZE = 100;
Game.BOARD_MATRIX = [
    [0, 0, 0],
    [0, 0, 0],
    [0, 0, 0]
];


/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
const Game_1 = __webpack_require__(/*! ./Game */ "./src/Game.ts");
const utils_1 = __webpack_require__(/*! ./utils */ "./src/utils.ts");
new Game_1.default(
// tslint:disable-next-line:only-arrow-functions
function () {
    console.log('Game has started!');
}, function () {
    // const state = this.state;
    const player = this.getCurrentPlayerLabel();
    console.log(`${player} moves ...`);
}, function () {
    const state = this.state;
    const player = this.getCurrentPlayerLabel();
    console.log(`It's ${player}'s turn`);
    // Random AI
    if (state.currentPlayer === Game_1.Player.O) {
        const freeBoardTilesByIndex = state.boardMatrix.reduce((acc, value) => {
            return acc.concat(value);
        }, []).reduce((acc2, value2, index) => {
            if (value2 > 0) {
                return acc2;
            }
            acc2.push(index);
            return acc2;
        }, []);
        console.log(freeBoardTilesByIndex);
        const randomIndex = utils_1.randomInt(0, freeBoardTilesByIndex.length - 1);
        const tileIndex = freeBoardTilesByIndex[randomIndex];
        document.querySelector(`#box-${tileIndex}`).click();
    }
}, function () {
    const state = this.state;
    if (state.result === Game_1.GameResult.WIN) {
        console.log(`${state.winner} has won!!!`);
    }
    else if (state.result === Game_1.GameResult.DRAW) {
        console.log(`Damn it's a draw!`);
    }
}).start();


/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.randomInt = exports.unique = void 0;
// Returns only the unique values of an array.
// eg. input [1,1,1] returns [1]
// eg. input [1,2,1] returns [1,2]
function unique(arr) {
    return arr.reduce((acc, currentValue) => {
        if (!acc.includes(currentValue)) {
            acc.push(currentValue);
        }
        return acc;
    }, []);
}
exports.unique = unique;
function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
exports.randomInt = randomInt;


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		if(__webpack_module_cache__[moduleId]) {
/******/ 			return __webpack_module_cache__[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	// startup
/******/ 	// Load entry module
/******/ 	__webpack_require__("./src/index.ts");
/******/ 	// This entry module used 'exports' so it can't be inlined
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly94by8uL3NyYy9HYW1lLnRzIiwid2VicGFjazovL3hvLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL3hvLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovL3hvL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3hvL3dlYnBhY2svc3RhcnR1cCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEscUVBQStCO0FBRS9CLElBQVksTUFJWDtBQUpELFdBQVksTUFBTTtJQUNkLG1DQUFRO0lBQ1IsNkJBQUs7SUFDTCw2QkFBSztBQUNULENBQUMsRUFKVyxNQUFNLEdBQU4sY0FBTSxLQUFOLGNBQU0sUUFJakI7QUFFRCxJQUFZLFVBSVg7QUFKRCxXQUFZLFVBQVU7SUFDbEIsaURBQVc7SUFDWCx5Q0FBTztJQUNQLDJDQUFRO0FBQ1osQ0FBQyxFQUpXLFVBQVUsR0FBVixrQkFBVSxLQUFWLGtCQUFVLFFBSXJCO0FBWUQsTUFBcUIsSUFBSTtJQTZCckIsWUFDcUIsT0FBb0IsRUFDcEIsWUFBeUIsRUFDekIsV0FBd0IsRUFDeEIsUUFBcUI7UUFIckIsWUFBTyxHQUFQLE9BQU8sQ0FBYTtRQUNwQixpQkFBWSxHQUFaLFlBQVksQ0FBYTtRQUN6QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixhQUFRLEdBQVIsUUFBUSxDQUFhO1FBdkIxQyxjQUFjO1FBQ0osVUFBSyxHQUFjO1lBQ3pCLFdBQVcsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQzlCLGtCQUFrQixFQUFFLEVBQUU7WUFDdEIsbUJBQW1CLEVBQUU7Z0JBQ2pCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2QsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTthQUNqQjtZQUNELE1BQU0sRUFBRSxFQUFFO1lBQ1YsWUFBWSxFQUFFLEVBQUU7WUFDaEIsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3ZCLE1BQU0s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LENBQUMsRUFBRTtZQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FBRTtRQUM1RCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNYLENBQUM7QUFMRCx3QkFLQztBQUVELFNBQWdCLFNBQVMsQ0FBQyxHQUFXLEVBQUUsR0FBVztJQUM5QyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztBQUM3RCxDQUFDO0FBRkQsOEJBRUM7Ozs7Ozs7VUNaRDtVQUNBOztVQUVBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTs7VUFFQTtVQUNBOztVQUVBO1VBQ0E7VUFDQTs7O1VDckJBO1VBQ0E7VUFDQTtVQUNBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7dW5pcXVlfSBmcm9tIFwiLi91dGlsc1wiO1xyXG5cclxuZXhwb3J0IGVudW0gUGxheWVyIHtcclxuICAgIE5PTkUgPSAwLFxyXG4gICAgWCA9IDEsXHJcbiAgICBPID0gMlxyXG59XHJcblxyXG5leHBvcnQgZW51bSBHYW1lUmVzdWx0IHtcclxuICAgIFBMQVlJTkcgPSAwLFxyXG4gICAgV0lOID0gMSxcclxuICAgIERSQVcgPSAyXHJcbn1cclxuXHJcbmludGVyZmFjZSBHYW1lU3RhdGUge1xyXG4gICAgYm9hcmRNYXRyaXg6IHR5cGVvZiBHYW1lLkJPQVJEX01BVFJJWCxcclxuICAgIHJvdW5kTW92ZXNQZXJJbmRleDogbnVtYmVyW107XHJcbiAgICByb3VuZE1vdmVzUGVyUGxheWVyOiB7W1BsYXllci5YXTogW10sIFtQbGF5ZXIuT106IFtdfTtcclxuICAgIHdpbm5lcjpzdHJpbmc7XHJcbiAgICB3aW5uaW5nVGlsZXM6IG51bWJlcltdW107XHJcbiAgICBjdXJyZW50UGxheWVyOiBQbGF5ZXI7XHJcbiAgICByZXN1bHQ6IEdhbWVSZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWUge1xyXG4gICAgLy8gU2V0dGluZ3MuXHJcbiAgICBwdWJsaWMgc3RhdGljIEJPQVJEX1NJWkU6IG51bWJlciA9IDM7XHJcbiAgICBwdWJsaWMgc3RhdGljIEJPQVJEX0JPWF9TSVpFOiBudW1iZXIgPSAxMDA7XHJcbiAgICBwdWJsaWMgc3RhdGljIEJPQVJEX01BVFJJWDogbnVtYmVyW11bXSA9IFtcclxuICAgICAgICBbMCwgMCwgMF0sXHJcbiAgICAgICAgWzAsIDAsIDBdLFxyXG4gICAgICAgIFswLCAwLCAwXVxyXG4gICAgXTtcclxuXHJcbiAgICAvLyBHYW1lIHN0YXRlLlxyXG4gICAgcHJvdGVjdGVkIHN0YXRlOiBHYW1lU3RhdGUgPSB7XHJcbiAgICAgICAgYm9hcmRNYXRyaXg6IHRoaXMuY2xvbmVCb2FyZCgpLFxyXG4gICAgICAgIHJvdW5kTW92ZXNQZXJJbmRleDogW10sXHJcbiAgICAgICAgcm91bmRNb3Zlc1BlclBsYXllcjoge1xyXG4gICAgICAgICAgICBbUGxheWVyLlhdOiBbXSxcclxuICAgICAgICAgICAgW1BsYXllci5PXTogW11cclxuICAgICAgICB9LFxyXG4gICAgICAgIHdpbm5lcjogXCJcIixcclxuICAgICAgICB3aW5uaW5nVGlsZXM6IFtdLFxyXG4gICAgICAgIGN1cnJlbnRQbGF5ZXI6IFBsYXllci5YLFxyXG4gICAgICAgIHJlc3VsdDogR2FtZVJlc3VsdC5QTEFZSU5HXHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGhlIHNjZW5lLiBET00gcmVmZXJlbmNlLlxyXG4gICAgcHJpdmF0ZSAkY2FudmFzO1xyXG4gICAgcHJpdmF0ZSAkc3RhcnRCdG47XHJcbiAgICBwcml2YXRlICRhbm5vdW5jZW1lbnRzO1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IG9uU3RhcnQ/OiAoKSA9PiB2b2lkLFxyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgb25CZWZvcmVNb3ZlPzogKCkgPT4gdm9pZCxcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IG9uQWZ0ZXJNb3ZlPzogKCkgPT4gdm9pZCxcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IG9uRmluaXNoPzogKCkgPT4gdm9pZCxcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMub25TdGFydCA9IG9uU3RhcnQ/LmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5vbkJlZm9yZU1vdmUgPSBvbkJlZm9yZU1vdmU/LmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5vbkFmdGVyTW92ZSA9IG9uQWZ0ZXJNb3ZlPy5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMub25GaW5pc2ggPSBvbkZpbmlzaD8uYmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xvbmVCb2FyZCgpIHtcclxuICAgICAgICByZXR1cm4gR2FtZS5CT0FSRF9NQVRSSVguc2xpY2UoMCkubWFwKChyb3cpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHJvdy5zbGljZSgwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXdTdGFydEJ1dHRvbigpIHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgZWxlbS5pbm5lclRleHQgPSBcIlJlLXN0YXJ0IGdhbWVcIjtcclxuICAgICAgICBlbGVtLnN0eWxlLm1hcmdpblRvcCA9IFwiMWVtXCI7XHJcbiAgICAgICAgZWxlbS5zdHlsZS51c2VyU2VsZWN0ID0gXCJub25lXCI7XHJcbiAgICAgICAgZWxlbS5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuXHJcbiAgICAgICAgdGhpcy4kc3RhcnRCdG4gPSBlbGVtO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5hcHBlbmRDaGlsZCh0aGlzLiRzdGFydEJ0bik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3QW5ub3VuY2VtZW50cyh0ZXh0OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgZWxlbS5zdHlsZS5wYWRkaW5nID0gXCIxZW1cIjtcclxuICAgICAgICBlbGVtLnN0eWxlLmZvbnRTdHlsZSA9IFwiaXRhbGljc1wiO1xyXG4gICAgICAgIGVsZW0uaW5uZXJUZXh0ID0gdGV4dDtcclxuXHJcbiAgICAgICAgdGhpcy4kYW5ub3VuY2VtZW50cyA9IGVsZW07XHJcbiAgICAgICAgdGhpcy4kY2FudmFzLmFwcGVuZENoaWxkKHRoaXMuJGFubm91bmNlbWVudHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlQW5ub3VuY2VtZW50cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy4kYW5ub3VuY2VtZW50cyAmJiB0aGlzLiRhbm5vdW5jZW1lbnRzLnJlbW92ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3Q2FudmFzKCkge1xyXG5cclxuICAgICAgICB0aGlzLiRjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcclxuICAgICAgICB0aGlzLiRjYW52YXMuc3R5bGUudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcclxuICAgICAgICB0aGlzLiRjYW52YXMuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XHJcbiAgICAgICAgdGhpcy4kY2FudmFzLmlkID0gXCJjYW52YXNcIjtcclxuXHJcbiAgICAgICAgdGhpcy4kY2FudmFzLnN0eWxlLndpZHRoID0gYCR7R2FtZS5CT0FSRF9CT1hfU0laRSAqIEdhbWUuQk9BUkRfU0laRX1weGA7XHJcbiAgICAgICAgdGhpcy4kY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke0dhbWUuQk9BUkRfQk9YX1NJWkUgKiBHYW1lLkJPQVJEX1NJWkV9cHhgO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IEdhbWUuQk9BUkRfU0laRSAqIEdhbWUuQk9BUkRfU0laRTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLmZsb2F0ID0gXCJsZWZ0XCI7XHJcbiAgICAgICAgICAgICRib3guc3R5bGUud2lkdGggPSBgJHtHYW1lLkJPQVJEX0JPWF9TSVpFfXB4YDtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5oZWlnaHQgPSBgJHtHYW1lLkJPQVJEX0JPWF9TSVpFfXB4YDtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5saW5lSGVpZ2h0ID0gYCR7R2FtZS5CT0FSRF9CT1hfU0laRX1weGA7XHJcbiAgICAgICAgICAgICRib3guc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgYmxhY2tcIjtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5ib3hTaGFkb3cgPSBcIjAgMCAwIDFweCBibGFja1wiO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLmZvbnRTaXplID0gYCR7R2FtZS5CT0FSRF9CT1hfU0laRSAvIDIgfXB4YDtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS51c2VyU2VsZWN0ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgICRib3guaWQgPSBgYm94LSR7aX1gO1xyXG4gICAgICAgICAgICAkYm94LmRhdGFzZXQuaW5kZXggPSBgJHtpfWA7XHJcbiAgICAgICAgICAgICRib3guZGF0YXNldC5yb3cgPSBgJHtNYXRoLmZsb29yKGkgLyBHYW1lLkJPQVJEX1NJWkUpfWA7XHJcbiAgICAgICAgICAgICRib3guZGF0YXNldC5jb2x1bW4gPSBgJHtpICUgR2FtZS5CT0FSRF9TSVpFfWA7XHJcbiAgICAgICAgICAgICRib3guY2xhc3NOYW1lID0gXCJib3hcIjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuJGNhbnZhcy5hcHBlbmRDaGlsZCgkYm94KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy4kY2FudmFzKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kRXZlbnRzKCkge1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9uQmVmb3JlTW92ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkJlZm9yZU1vdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm9uQm9hcmRCb3hDbGljay5iaW5kKHRoaXMpKGUpO1xyXG4gICAgICAgICAgICAvLyBPbmx5IGV4ZWN1dGUgdGhlIG5leHQgY2FsbGJhY2sgaWYgdGhlIGdhbWUgaXMgbm90IGZpbmlzaGVkLlxyXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5yZXN1bHQgPT09IEdhbWVSZXN1bHQuUExBWUlORyAmJiB0aGlzLm9uQWZ0ZXJNb3ZlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uQWZ0ZXJNb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy4kc3RhcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZXNldFJlbmRlcigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25Cb2FyZEJveENsaWNrKGU6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBjb25zdCAkYm94ID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgLy8gUHJldmVudCBwcm9wYWdhdGluZyBjbGljayBjYWxsYmFjayBpZjpcclxuICAgICAgICAvLyAxLiB0aGUgRE9NIGVsZW1lbnQgY2xpY2tlZCBpcyBub3QgYSBcImJveFwiLlxyXG4gICAgICAgIC8vIDIuIHRoZSBcImJveFwiIGFscmVhZHkgaGFzIGEgdmFsdWUgaW4gaXQuXHJcbiAgICAgICAgLy8gMy4gQSBwbGF5ZXIgYWxyZWFkeSB3b24gdGhlIGdhbWUuXHJcbiAgICAgICAgaWYgKCRib3guY2xhc3NOYW1lICE9PSBcImJveFwiIHx8ICRib3guaW5uZXJUZXh0ICE9PSBcIlwiIHx8IHRoaXMuc3RhdGUucmVzdWx0ICE9PSBHYW1lUmVzdWx0LlBMQVlJTkcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkYm94LmRhdGFzZXQuaW5kZXggYXMgc3RyaW5nLCAxMCk7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gcGFyc2VJbnQoJGJveC5kYXRhc2V0LnJvdyBhcyBzdHJpbmcsIDEwKTtcclxuICAgICAgICBjb25zdCBjb2x1bW4gPSBwYXJzZUludCgkYm94LmRhdGFzZXQuY29sdW1uIGFzIHN0cmluZywgMTApO1xyXG5cclxuICAgICAgICAvLyBTdG9yZSByb3VuZCBtb3Zlcy5cclxuICAgICAgICB0aGlzLnN0YXRlLnJvdW5kTW92ZXNQZXJQbGF5ZXJbdGhpcy5zdGF0ZS5jdXJyZW50UGxheWVyXS5wdXNoKGluZGV4KTtcclxuICAgICAgICB0aGlzLnN0YXRlLnJvdW5kTW92ZXNQZXJJbmRleC5wdXNoKGluZGV4KTtcclxuICAgICAgICB0aGlzLnN0YXRlLmJvYXJkTWF0cml4W3Jvd11bY29sdW1uXSA9IHRoaXMuc3RhdGUuY3VycmVudFBsYXllcjtcclxuXHJcbiAgICAgICAgJGJveC5pbm5lclRleHQgPSB0aGlzLmdldEN1cnJlbnRQbGF5ZXJMYWJlbCgpO1xyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNoZWNrR2FtZVJlc3VsdCgpO1xyXG5cclxuICAgICAgICBpZiAoW0dhbWVSZXN1bHQuV0lOLCBHYW1lUmVzdWx0LkRSQVddLmluY2x1ZGVzKHJlc3VsdCkpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gR2FtZVJlc3VsdC5XSU4pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUud2lubmluZ1RpbGVzLmZvckVhY2goKHRpbGVBcnIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcm93PVwiJHt0aWxlQXJyWzBdfVwiXVtkYXRhLWNvbHVtbj1cIiR7dGlsZUFyclsxXX1cIl1gKSBhcyBIVE1MRWxlbWVudCkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3QW5ub3VuY2VtZW50cyhgJHt0aGlzLnN0YXRlLndpbm5lcn0gaGFzIHdvbiFgKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgPT09IEdhbWVSZXN1bHQuRFJBVykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3QW5ub3VuY2VtZW50cyhgSXQncyBhIGRyYXchYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMub25GaW5pc2gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25GaW5pc2goKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU3dpdGNoIHRvIHRoZSBuZXh0IHBsYXllci5cclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50UGxheWVyID09PSBQbGF5ZXIuWCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlLmN1cnJlbnRQbGF5ZXIgPSBQbGF5ZXIuTztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlLmN1cnJlbnRQbGF5ZXIgPSBQbGF5ZXIuWDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvLyBNZXRob2RvbG9neTogYnJ1dGUgY2hlY2sgYWxsIHJvd3MgYW5kIGNvbHVtbnMgYW5kIGRpYWdvbmFscy5cclxuICAgIHByaXZhdGUgY2hlY2tHYW1lUmVzdWx0KCk6IEdhbWVSZXN1bHQge1xyXG5cclxuICAgICAgICAvLyBEb24ndCBwZXJmb3JtIHdpbm5pbmcgY2hlY2sgdW50aWwgYXQgbGVhc3QgNSBtb3Zlcy5cclxuICAgICAgICAvLyA1IG1vdmVzIG1lYW4gdGhhdCBYIGhhcyBtb3ZlZCAzIHRpbWVzIGFuZCBPIG9ubHkgMiB0aW1lcy5cclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5yb3VuZE1vdmVzUGVySW5kZXgubGVuZ3RoIDwgKChHYW1lLkJPQVJEX1NJWkUgKiAyKSAtIDEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBHYW1lUmVzdWx0LlBMQVlJTkc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IEdhbWUuQk9BUkRfU0laRTsgaSsrKSB7XHJcbiAgICAgICAgICAgIC8vIENoZWNrIHJvd3MuXHJcbiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSB1bmlxdWUodGhpcy5zdGF0ZS5ib2FyZE1hdHJpeFtpXSk7XHJcbiAgICAgICAgICAgIGlmIChyb3dzLmxlbmd0aCA9PT0gMSAmJiByb3dzWzBdICE9PSBQbGF5ZXIuTk9ORSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS53aW5uZXIgPSB0aGlzLmdldEN1cnJlbnRQbGF5ZXJMYWJlbCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS53aW5uaW5nVGlsZXMgPSBbW2ksIDBdLCBbaSwgMV0sIFtpLCAyXV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnJlc3VsdCA9IEdhbWVSZXN1bHQuV0lOO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEdhbWVSZXN1bHQuV0lOO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENoZWNrIGNvbHVtbnMuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSB1bmlxdWUoW3RoaXMuc3RhdGUuYm9hcmRNYXRyaXhbMF1baV0sIHRoaXMuc3RhdGUuYm9hcmRNYXRyaXhbMV1baV0sIHRoaXMuc3RhdGUuYm9hcmRNYXRyaXhbMl1baV1dKTtcclxuICAgICAgICAgICAgaWYgKGNvbHVtbnMubGVuZ3RoID09PSAxICYmIGNvbHVtbnNbMF0gIT09IFBsYXllci5OT05FKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLndpbm5lciA9IHRoaXMuZ2V0Q3VycmVudFBsYXllckxhYmVsKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLndpbm5pbmdUaWxlcyA9IFtbMCwgaV0sIFsxLCBpXSwgWzIsIGldXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUucmVzdWx0ID0gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGRpYWdzLlxyXG4gICAgICAgIGNvbnN0IGRpYWcxID0gdW5pcXVlKFt0aGlzLnN0YXRlLmJvYXJkTWF0cml4WzBdWzBdLCB0aGlzLnN0YXRlLmJvYXJkTWF0cml4WzFdWzFdLCB0aGlzLnN0YXRlLmJvYXJkTWF0cml4WzJdWzJdXSk7XHJcbiAgICAgICAgaWYgKGRpYWcxLmxlbmd0aCA9PT0gMSAmJiBkaWFnMVswXSAhPT0gUGxheWVyLk5PTkUpIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS53aW5uZXIgPSB0aGlzLmdldEN1cnJlbnRQbGF5ZXJMYWJlbCgpO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlLndpbm5pbmdUaWxlcyA9IFtbMCwgMF0sIFsxLCAxXSwgWzIsIDJdXTtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5yZXN1bHQgPSBHYW1lUmVzdWx0LldJTjtcclxuICAgICAgICAgICAgcmV0dXJuIEdhbWVSZXN1bHQuV0lOO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGlhZzIgPSB1bmlxdWUoW3RoaXMuc3RhdGUuYm9hcmRNYXRyaXhbMF1bMl0sIHRoaXMuc3RhdGUuYm9hcmRNYXRyaXhbMV1bMV0sIHRoaXMuc3RhdGUuYm9hcmRNYXRyaXhbMl1bMF1dKTtcclxuICAgICAgICBpZiAoZGlhZzIubGVuZ3RoID09PSAxICYmIGRpYWcyWzBdICE9PSBQbGF5ZXIuTk9ORSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlLndpbm5lciA9IHRoaXMuZ2V0Q3VycmVudFBsYXllckxhYmVsKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUud2lubmluZ1RpbGVzID0gW1swLCAyXSwgWzEsIDFdLCBbMiwgMF1dO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnJlc3VsdCA9IEdhbWVSZXN1bHQuV0lOO1xyXG4gICAgICAgICAgICByZXR1cm4gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5yb3VuZE1vdmVzUGVySW5kZXgubGVuZ3RoID09PSBHYW1lLkJPQVJEX1NJWkUgKiBHYW1lLkJPQVJEX1NJWkUpIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5yZXN1bHQgPSBHYW1lUmVzdWx0LkRSQVc7XHJcbiAgICAgICAgICAgIHJldHVybiBHYW1lUmVzdWx0LkRSQVc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gR2FtZVJlc3VsdC5QTEFZSU5HO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRDdXJyZW50UGxheWVyTGFiZWwoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jdXJyZW50UGxheWVyID09PSBQbGF5ZXIuWCA/IFwiWFwiIDogXCJPXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICB0aGlzLmRyYXdDYW52YXMoKTtcclxuICAgICAgICB0aGlzLmRyYXdTdGFydEJ1dHRvbigpO1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50cygpO1xyXG4gICAgICAgIGlmICh0aGlzLm9uU3RhcnQpIHtcclxuICAgICAgICAgICAgdGhpcy5vblN0YXJ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZXNldCgpIHtcclxuICAgICAgICB0aGlzLnN0YXRlLndpbm5lciA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5zdGF0ZS53aW5uaW5nVGlsZXMgPSBbXTtcclxuICAgICAgICB0aGlzLnN0YXRlLnJvdW5kTW92ZXNQZXJJbmRleCA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3RhdGUucm91bmRNb3Zlc1BlclBsYXllciA9IHtcclxuICAgICAgICAgICAgW1BsYXllci5YXTogW10sXHJcbiAgICAgICAgICAgIFtQbGF5ZXIuT106IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnN0YXRlLmN1cnJlbnRQbGF5ZXIgPSBQbGF5ZXIuWDtcclxuICAgICAgICB0aGlzLnN0YXRlLmJvYXJkTWF0cml4ID0gdGhpcy5jbG9uZUJvYXJkKCk7XHJcbiAgICAgICAgdGhpcy5zdGF0ZS5yZXN1bHQgPSBHYW1lUmVzdWx0LlBMQVlJTkc7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlc2V0UmVuZGVyKCkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQW5ub3VuY2VtZW50cygpO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5xdWVyeVNlbGVjdG9yQWxsKFwiLmJveFwiKS5mb3JFYWNoKCgkYm94KSA9PiB7XHJcbiAgICAgICAgICAgICRib3guaW5uZXJUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIlwiO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IEdhbWUsIHtHYW1lUmVzdWx0LCBQbGF5ZXJ9IGZyb20gXCIuL0dhbWVcIjtcclxuaW1wb3J0IHtyYW5kb21JbnR9IGZyb20gXCIuL3V0aWxzXCI7XHJcblxyXG5uZXcgR2FtZShcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpvbmx5LWFycm93LWZ1bmN0aW9uc1xyXG4gICAgZnVuY3Rpb24odGhpczogR2FtZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdHYW1lIGhhcyBzdGFydGVkIScpO1xyXG4gICAgfSxcclxuICAgIGZ1bmN0aW9uICh0aGlzOiBHYW1lKSB7XHJcbiAgICAgICAgLy8gY29uc3Qgc3RhdGUgPSB0aGlzLnN0YXRlO1xyXG4gICAgICAgIGNvbnN0IHBsYXllciA9IHRoaXMuZ2V0Q3VycmVudFBsYXllckxhYmVsKCk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKGAke3BsYXllcn0gbW92ZXMgLi4uYCk7XHJcbiAgICB9LFxyXG4gICAgZnVuY3Rpb24gKHRoaXM6IEdhbWUpIHtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc3RhdGU7XHJcbiAgICAgICAgY29uc3QgcGxheWVyID0gdGhpcy5nZXRDdXJyZW50UGxheWVyTGFiZWwoKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coYEl0J3MgJHtwbGF5ZXJ9J3MgdHVybmApO1xyXG5cclxuICAgICAgICAvLyBSYW5kb20gQUlcclxuICAgICAgICBpZiAoc3RhdGUuY3VycmVudFBsYXllciA9PT0gUGxheWVyLk8pIHtcclxuICAgICAgICAgICAgY29uc3QgZnJlZUJvYXJkVGlsZXNCeUluZGV4ID0gc3RhdGUuYm9hcmRNYXRyaXgucmVkdWNlKChhY2MsIHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjLmNvbmNhdCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sIFtdKS5yZWR1Y2UoKGFjYzIsIHZhbHVlMiwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZTIgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYzI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAoYWNjMiBhcyBudW1iZXJbXSkucHVzaChpbmRleCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjMjtcclxuICAgICAgICAgICAgfSwgW10pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhmcmVlQm9hcmRUaWxlc0J5SW5kZXgpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSByYW5kb21JbnQoMCwgZnJlZUJvYXJkVGlsZXNCeUluZGV4Lmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICBjb25zdCB0aWxlSW5kZXggPSBmcmVlQm9hcmRUaWxlc0J5SW5kZXhbcmFuZG9tSW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNib3gtJHt0aWxlSW5kZXh9YCkgYXMgSFRNTEVsZW1lbnQpLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcbiAgICBmdW5jdGlvbih0aGlzOiBHYW1lKSB7XHJcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnN0YXRlO1xyXG5cclxuICAgICAgICBpZiAoc3RhdGUucmVzdWx0ID09PSBHYW1lUmVzdWx0LldJTikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtzdGF0ZS53aW5uZXJ9IGhhcyB3b24hISFgKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLnJlc3VsdCA9PT0gR2FtZVJlc3VsdC5EUkFXKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBEYW1uIGl0J3MgYSBkcmF3IWApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuKS5zdGFydCgpOyIsIi8vIFJldHVybnMgb25seSB0aGUgdW5pcXVlIHZhbHVlcyBvZiBhbiBhcnJheS5cclxuLy8gZWcuIGlucHV0IFsxLDEsMV0gcmV0dXJucyBbMV1cclxuLy8gZWcuIGlucHV0IFsxLDIsMV0gcmV0dXJucyBbMSwyXVxyXG5leHBvcnQgZnVuY3Rpb24gdW5pcXVlKGFycjogbnVtYmVyW10pOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gYXJyLnJlZHVjZSgoYWNjOiBudW1iZXJbXSwgY3VycmVudFZhbHVlOiBudW1iZXIpID0+IHtcclxuICAgICAgICBpZiAoIWFjYy5pbmNsdWRlcyhjdXJyZW50VmFsdWUpKSB7IGFjYy5wdXNoKGN1cnJlbnRWYWx1ZSk7IH1cclxuICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgfSwgW10pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tSW50KG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGVcbl9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9pbmRleC50c1wiKTtcbi8vIFRoaXMgZW50cnkgbW9kdWxlIHVzZWQgJ2V4cG9ydHMnIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbiJdLCJzb3VyY2VSb290IjoiIn0=