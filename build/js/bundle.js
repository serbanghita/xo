/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/Game.ts":
/*!*********************!*\
  !*** ./src/Game.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
const utils_1 = __webpack_require__(/*! ./utils */ "./src/utils.ts");
var Player;
(function (Player) {
    Player[Player["NONE"] = 0] = "NONE";
    Player[Player["X"] = 1] = "X";
    Player[Player["O"] = 2] = "O";
})(Player || (Player = {}));
var GameResult;
(function (GameResult) {
    GameResult[GameResult["PLAYING"] = 0] = "PLAYING";
    GameResult[GameResult["WIN"] = 1] = "WIN";
    GameResult[GameResult["DRAW"] = 2] = "DRAW";
})(GameResult || (GameResult = {}));
class Game {
    constructor() {
        this.boxSize = 100;
        this.board = [
            [0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]
        ];
        this.roundMovesPerIndex = [];
        this.roundMovesPerPlayer = {
            [Player.X]: [],
            [Player.O]: []
        };
        this.winner = "";
        this.winningTiles = [];
        this.currentPlayer = Player.X;
        this.gameResult = GameResult.PLAYING;
    }
    drawStartButton() {
        const elem = document.createElement("button");
        elem.style.display = "absolute";
        elem.innerText = "Re-start game";
        elem.style.marginTop = "1em";
        elem.style.userSelect = "none";
        elem.style.cursor = "pointer";
        this.$startBtn = elem;
        this.$canvas.appendChild(this.$startBtn);
    }
    drawAnnouncements(text) {
        const elem = document.createElement("div");
        elem.style.display = "absolute";
        elem.style.padding = "1em";
        elem.style.fontStyle = "italics";
        elem.innerText = text;
        this.$announcements = elem;
        this.$canvas.appendChild(this.$announcements);
    }
    removeAnnouncements() {
        this.$announcements && this.$announcements.remove();
    }
    drawCanvas() {
        this.$canvas = document.createElement("div");
        this.$canvas.style.boxSizing = "border-box";
        this.$canvas.style.textAlign = "center";
        this.$canvas.style.position = "relative";
        this.$canvas.id = "canvas";
        this.$canvas.style.width = `${this.boxSize * 3}px`;
        this.$canvas.style.height = `${this.boxSize * 3}px`;
        for (let i = 0; i < 3 * 3; i++) {
            const $box = document.createElement("div");
            $box.style.float = "left";
            $box.style.width = `${this.boxSize}px`;
            $box.style.height = `${this.boxSize}px`;
            $box.style.lineHeight = `${this.boxSize}px`;
            $box.style.border = "1px solid black";
            $box.style.boxShadow = "0 0 0 1px black";
            $box.style.boxSizing = "border-box";
            $box.style.fontSize = "50px";
            $box.style.cursor = "pointer";
            $box.style.userSelect = "none";
            $box.id = `box-${i}`;
            $box.dataset.index = `${i}`;
            $box.dataset.row = `${Math.floor(i / 3)}`;
            $box.dataset.column = `${i % 3}`;
            $box.className = "box";
            this.$canvas.appendChild($box);
        }
        document.body.appendChild(this.$canvas);
    }
    bindEvents() {
        this.$canvas.addEventListener('click', (e) => {
            const $box = e.target;
            // Prevent propagating click callback if:
            // 1. the DOM element clicked is not a "box".
            // 2. the "box" already has a value in it.
            // 3. A player already won the game.
            if ($box.className !== "box" || $box.innerText !== "" || this.gameResult !== GameResult.PLAYING) {
                return false;
            }
            const index = $box.dataset.index;
            const row = $box.dataset.row;
            const column = $box.dataset.column;
            // Store round moves.
            this.roundMovesPerPlayer[this.currentPlayer].push(index);
            this.roundMovesPerIndex.push(index);
            this.board[row][column] = this.currentPlayer;
            console.log(this.board, this.roundMovesPerIndex);
            $box.innerText = this.currentPlayer === Player.X ? "X" : "O";
            if (this.currentPlayer === Player.X) {
                this.currentPlayer = Player.O;
            }
            else {
                this.currentPlayer = Player.X;
            }
            const winCheck = this.checkGameResult();
            if (winCheck === GameResult.WIN) {
                console.log(`${this.winner} has won!`);
                this.winningTiles.forEach((tileArr) => {
                    document.querySelector(`[data-row="${tileArr[0]}"][data-column="${tileArr[1]}"]`).style.backgroundColor = "red";
                });
                this.drawAnnouncements(`${this.winner} has won!`);
            }
            else if (winCheck === GameResult.DRAW) {
                console.log(`It's a draw!`);
                this.drawAnnouncements(`It's a draw!`);
            }
        });
        this.$startBtn.addEventListener('click', () => {
            this.reset();
            this.resetRender();
        });
    }
    // Methodology: brute check all rows and columns and diagonals.
    checkGameResult() {
        // Don't perform winning check until at least 5 moves.
        // 5 moves mean that X has moved 3 times and O only 2 times.
        if (this.roundMovesPerIndex.length < 5) {
            return GameResult.PLAYING;
        }
        for (let i = 0; i < 3; i++) {
            // Check rows.
            const rows = utils_1.unique(this.board[i]);
            if (rows.length === 1 && rows[0] !== Player.NONE) {
                this.winner = this.getPlayerName(this.board[i][0]);
                this.winningTiles = [[i, 0], [i, 1], [i, 2]];
                this.gameResult = GameResult.WIN;
                return GameResult.WIN;
            }
            // Check columns.
            const columns = utils_1.unique([this.board[0][i], this.board[1][i], this.board[2][i]]);
            if (columns.length === 1 && columns[0] !== Player.NONE) {
                this.winner = this.getPlayerName(this.board[0][i]);
                this.winningTiles = [[0, i], [1, i], [2, i]];
                this.gameResult = GameResult.WIN;
                return GameResult.WIN;
            }
        }
        // Check diags.
        const diag1 = utils_1.unique([this.board[0][0], this.board[1][1], this.board[2][2]]);
        if (diag1.length === 1 && diag1[0] !== Player.NONE) {
            this.winner = this.getPlayerName(this.board[0][0]);
            this.winningTiles = [[0, 0], [1, 1], [2, 2]];
            this.gameResult = GameResult.WIN;
            return GameResult.WIN;
        }
        const diag2 = utils_1.unique([this.board[0][2], this.board[1][1], this.board[2][0]]);
        if (diag2.length === 1 && diag2[0] !== Player.NONE) {
            this.winner = this.getPlayerName(this.board[0][2]);
            this.winningTiles = [[0, 2], [1, 1], [2, 0]];
            this.gameResult = GameResult.WIN;
            return GameResult.WIN;
        }
        if (this.roundMovesPerIndex.length === 3 * 3) {
            this.gameResult = GameResult.DRAW;
            return GameResult.DRAW;
        }
        return GameResult.PLAYING;
    }
    getPlayerName(player) {
        return player === Player.X ? "X" : "O";
    }
    start() {
        this.reset();
        this.drawCanvas();
        this.drawStartButton();
        this.bindEvents();
    }
    reset() {
        this.winner = "";
        this.winningTiles = [];
        this.roundMovesPerIndex = [];
        this.roundMovesPerPlayer = {
            [Player.X]: [],
            [Player.O]: []
        };
        this.currentPlayer = Player.X;
        this.board = [
            [0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]
        ];
        this.gameResult = GameResult.PLAYING;
    }
    resetRender() {
        this.removeAnnouncements();
        this.$canvas.querySelectorAll(".box").forEach(($box) => {
            $box.innerText = "";
            $box.style.backgroundColor = "";
        });
    }
}
exports.default = Game;


/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
const Game_1 = __webpack_require__(/*! ./Game */ "./src/Game.ts");
new Game_1.default().start();


/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.unique = void 0;
// Returns only the unique values of an array.
// eg. input [1,1,1] returns [1]
// eg. input [1,2,1] returns [1,2]
function unique(arr) {
    return arr.reduce((acc, currentValue) => {
        if (!acc.includes(currentValue)) {
            acc.push(currentValue);
        }
        return acc;
    }, []);
}
exports.unique = unique;


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		if(__webpack_module_cache__[moduleId]) {
/******/ 			return __webpack_module_cache__[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	// startup
/******/ 	// Load entry module
/******/ 	__webpack_require__("./src/index.ts");
/******/ 	// This entry module used 'exports' so it can't be inlined
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly94by8uL3NyYy9HYW1lLnRzIiwid2VicGFjazovL3hvLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL3hvLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovL3hvL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3hvL3dlYnBhY2svc3RhcnR1cCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSxxRUFBK0I7QUFFL0IsSUFBSyxNQUlKO0FBSkQsV0FBSyxNQUFNO0lBQ1AsbUNBQVE7SUFDUiw2QkFBSztJQUNMLDZCQUFLO0FBQ1QsQ0FBQyxFQUpJLE1BQU0sS0FBTixNQUFNLFFBSVY7QUFFRCxJQUFLLFVBSUo7QUFKRCxXQUFLLFVBQVU7SUFDWCxpREFBVztJQUNYLHlDQUFPO0lBQ1AsMkNBQVE7QUFDWixDQUFDLEVBSkksVUFBVSxLQUFWLFVBQVUsUUFJZDtBQUVELE1BQXFCLElBQUk7SUFBekI7UUFDWSxZQUFPLEdBQVcsR0FBRyxDQUFDO1FBQ3RCLFVBQUssR0FBZTtZQUN4QixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ1QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNULENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDWixDQUFDO1FBQ00sdUJBQWtCLEdBQWEsRUFBRSxDQUFDO1FBQ2xDLHdCQUFtQixHQUFHO1lBQzFCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDZCxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1NBQ2pCLENBQUM7UUFDTSxXQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ1osaUJBQVksR0FBZSxFQUFFLENBQUM7UUFDOUIsa0JBQWEsR0FBVyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLGVBQVUsR0FBZSxVQUFVLENBQUMsT0FBTyxDQUFDO0lBaU54RCxDQUFDO0lBMU1XLGVBQWU7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QUFFO1FBQzVELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQUxELHdCQUtDOzs7Ozs7O1VDUkQ7VUFDQTs7VUFFQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7O1VBRUE7VUFDQTs7VUFFQTtVQUNBO1VBQ0E7OztVQ3JCQTtVQUNBO1VBQ0E7VUFDQSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3VuaXF1ZX0gZnJvbSBcIi4vdXRpbHNcIjtcclxuXHJcbmVudW0gUGxheWVyIHtcclxuICAgIE5PTkUgPSAwLFxyXG4gICAgWCA9IDEsXHJcbiAgICBPID0gMlxyXG59XHJcblxyXG5lbnVtIEdhbWVSZXN1bHQge1xyXG4gICAgUExBWUlORyA9IDAsXHJcbiAgICBXSU4gPSAxLFxyXG4gICAgRFJBVyA9IDJcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XHJcbiAgICBwcml2YXRlIGJveFNpemU6IG51bWJlciA9IDEwMDtcclxuICAgIHByaXZhdGUgYm9hcmQ6IG51bWJlcltdW10gPSBbXHJcbiAgICAgICAgWzAsIDAsIDBdLFxyXG4gICAgICAgIFswLCAwLCAwXSxcclxuICAgICAgICBbMCwgMCwgMF1cclxuICAgIF07XHJcbiAgICBwcml2YXRlIHJvdW5kTW92ZXNQZXJJbmRleDogbnVtYmVyW10gPSBbXTtcclxuICAgIHByaXZhdGUgcm91bmRNb3Zlc1BlclBsYXllciA9IHtcclxuICAgICAgICBbUGxheWVyLlhdOiBbXSxcclxuICAgICAgICBbUGxheWVyLk9dOiBbXVxyXG4gICAgfTtcclxuICAgIHByaXZhdGUgd2lubmVyID0gXCJcIjtcclxuICAgIHByaXZhdGUgd2lubmluZ1RpbGVzOiBudW1iZXJbXVtdID0gW107XHJcbiAgICBwcml2YXRlIGN1cnJlbnRQbGF5ZXI6IFBsYXllciA9IFBsYXllci5YO1xyXG4gICAgcHJpdmF0ZSBnYW1lUmVzdWx0OiBHYW1lUmVzdWx0ID0gR2FtZVJlc3VsdC5QTEFZSU5HO1xyXG5cclxuICAgIC8vIFRoZSBzY2VuZS4gRE9NIHJlZmVyZW5jZS5cclxuICAgIHByaXZhdGUgJGNhbnZhcztcclxuICAgIHByaXZhdGUgJHN0YXJ0QnRuO1xyXG4gICAgcHJpdmF0ZSAkYW5ub3VuY2VtZW50cztcclxuXHJcbiAgICBwcml2YXRlIGRyYXdTdGFydEJ1dHRvbigpIHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgZWxlbS5pbm5lclRleHQgPSBcIlJlLXN0YXJ0IGdhbWVcIjtcclxuICAgICAgICBlbGVtLnN0eWxlLm1hcmdpblRvcCA9IFwiMWVtXCI7XHJcbiAgICAgICAgZWxlbS5zdHlsZS51c2VyU2VsZWN0ID0gXCJub25lXCI7XHJcbiAgICAgICAgZWxlbS5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuXHJcbiAgICAgICAgdGhpcy4kc3RhcnRCdG4gPSBlbGVtO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5hcHBlbmRDaGlsZCh0aGlzLiRzdGFydEJ0bik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3QW5ub3VuY2VtZW50cyh0ZXh0OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgZWxlbS5zdHlsZS5wYWRkaW5nID0gXCIxZW1cIjtcclxuICAgICAgICBlbGVtLnN0eWxlLmZvbnRTdHlsZSA9IFwiaXRhbGljc1wiO1xyXG4gICAgICAgIGVsZW0uaW5uZXJUZXh0ID0gdGV4dDtcclxuXHJcbiAgICAgICAgdGhpcy4kYW5ub3VuY2VtZW50cyA9IGVsZW07XHJcbiAgICAgICAgdGhpcy4kY2FudmFzLmFwcGVuZENoaWxkKHRoaXMuJGFubm91bmNlbWVudHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlQW5ub3VuY2VtZW50cygpIHtcclxuICAgICAgICB0aGlzLiRhbm5vdW5jZW1lbnRzICYmIHRoaXMuJGFubm91bmNlbWVudHMucmVtb3ZlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXdDYW52YXMoKSB7XHJcblxyXG4gICAgICAgIHRoaXMuJGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGhpcy4kY2FudmFzLnN0eWxlLmJveFNpemluZyA9IFwiYm9yZGVyLWJveFwiO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5zdHlsZS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcclxuICAgICAgICB0aGlzLiRjYW52YXMuaWQgPSBcImNhbnZhc1wiO1xyXG5cclxuICAgICAgICB0aGlzLiRjYW52YXMuc3R5bGUud2lkdGggPSBgJHt0aGlzLmJveFNpemUgKiAzfXB4YDtcclxuICAgICAgICB0aGlzLiRjYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5ib3hTaXplICogM31weGA7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMyAqIDM7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCAkYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5mbG9hdCA9IFwibGVmdFwiO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLndpZHRoID0gYCR7dGhpcy5ib3hTaXplfXB4YDtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLmJveFNpemV9cHhgO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLmxpbmVIZWlnaHQgPSBgJHt0aGlzLmJveFNpemV9cHhgO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkIGJsYWNrXCI7XHJcbiAgICAgICAgICAgICRib3guc3R5bGUuYm94U2hhZG93ID0gXCIwIDAgMCAxcHggYmxhY2tcIjtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5mb250U2l6ZSA9IFwiNTBweFwiO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xyXG4gICAgICAgICAgICAkYm94LnN0eWxlLnVzZXJTZWxlY3QgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgJGJveC5pZCA9IGBib3gtJHtpfWA7XHJcbiAgICAgICAgICAgICRib3guZGF0YXNldC5pbmRleCA9IGAke2l9YDtcclxuICAgICAgICAgICAgJGJveC5kYXRhc2V0LnJvdyA9IGAke01hdGguZmxvb3IoaSAvIDMpfWA7XHJcbiAgICAgICAgICAgICRib3guZGF0YXNldC5jb2x1bW4gPSBgJHtpICUgM31gO1xyXG4gICAgICAgICAgICAkYm94LmNsYXNzTmFtZSA9IFwiYm94XCI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLiRjYW52YXMuYXBwZW5kQ2hpbGQoJGJveCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuJGNhbnZhcyk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEV2ZW50cygpIHtcclxuXHJcbiAgICAgICAgdGhpcy4kY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgJGJveCA9IGUudGFyZ2V0O1xyXG4gICAgICAgICAgICAvLyBQcmV2ZW50IHByb3BhZ2F0aW5nIGNsaWNrIGNhbGxiYWNrIGlmOlxyXG4gICAgICAgICAgICAvLyAxLiB0aGUgRE9NIGVsZW1lbnQgY2xpY2tlZCBpcyBub3QgYSBcImJveFwiLlxyXG4gICAgICAgICAgICAvLyAyLiB0aGUgXCJib3hcIiBhbHJlYWR5IGhhcyBhIHZhbHVlIGluIGl0LlxyXG4gICAgICAgICAgICAvLyAzLiBBIHBsYXllciBhbHJlYWR5IHdvbiB0aGUgZ2FtZS5cclxuICAgICAgICAgICAgaWYgKCRib3guY2xhc3NOYW1lICE9PSBcImJveFwiIHx8ICRib3guaW5uZXJUZXh0ICE9PSBcIlwiIHx8IHRoaXMuZ2FtZVJlc3VsdCAhPT0gR2FtZVJlc3VsdC5QTEFZSU5HKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gJGJveC5kYXRhc2V0LmluZGV4O1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSAkYm94LmRhdGFzZXQucm93O1xyXG4gICAgICAgICAgICBjb25zdCBjb2x1bW4gPSAkYm94LmRhdGFzZXQuY29sdW1uO1xyXG5cclxuICAgICAgICAgICAgLy8gU3RvcmUgcm91bmQgbW92ZXMuXHJcbiAgICAgICAgICAgIHRoaXMucm91bmRNb3Zlc1BlclBsYXllclt0aGlzLmN1cnJlbnRQbGF5ZXJdLnB1c2goaW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLnJvdW5kTW92ZXNQZXJJbmRleC5wdXNoKGluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0gPSB0aGlzLmN1cnJlbnRQbGF5ZXI7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYm9hcmQsIHRoaXMucm91bmRNb3Zlc1BlckluZGV4KTtcclxuXHJcbiAgICAgICAgICAgICRib3guaW5uZXJUZXh0ID0gdGhpcy5jdXJyZW50UGxheWVyID09PSBQbGF5ZXIuWCA/IFwiWFwiIDogXCJPXCI7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBQbGF5ZXIuWCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyID0gUGxheWVyLk87XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXIgPSBQbGF5ZXIuWDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgd2luQ2hlY2sgPSB0aGlzLmNoZWNrR2FtZVJlc3VsdCgpO1xyXG4gICAgICAgICAgICBpZiAod2luQ2hlY2sgPT09IEdhbWVSZXN1bHQuV0lOKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLndpbm5lcn0gaGFzIHdvbiFgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMud2lubmluZ1RpbGVzLmZvckVhY2goKHRpbGVBcnIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcm93PVwiJHt0aWxlQXJyWzBdfVwiXVtkYXRhLWNvbHVtbj1cIiR7dGlsZUFyclsxXX1cIl1gKSBhcyBIVE1MRWxlbWVudCkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3QW5ub3VuY2VtZW50cyhgJHt0aGlzLndpbm5lcn0gaGFzIHdvbiFgKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5DaGVjayA9PT0gR2FtZVJlc3VsdC5EUkFXKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgSXQncyBhIGRyYXchYCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdBbm5vdW5jZW1lbnRzKGBJdCdzIGEgZHJhdyFgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy4kc3RhcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5yZXNldFJlbmRlcigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvLyBNZXRob2RvbG9neTogYnJ1dGUgY2hlY2sgYWxsIHJvd3MgYW5kIGNvbHVtbnMgYW5kIGRpYWdvbmFscy5cclxuICAgIHByaXZhdGUgY2hlY2tHYW1lUmVzdWx0KCk6IEdhbWVSZXN1bHQge1xyXG5cclxuICAgICAgICAvLyBEb24ndCBwZXJmb3JtIHdpbm5pbmcgY2hlY2sgdW50aWwgYXQgbGVhc3QgNSBtb3Zlcy5cclxuICAgICAgICAvLyA1IG1vdmVzIG1lYW4gdGhhdCBYIGhhcyBtb3ZlZCAzIHRpbWVzIGFuZCBPIG9ubHkgMiB0aW1lcy5cclxuICAgICAgICBpZiAodGhpcy5yb3VuZE1vdmVzUGVySW5kZXgubGVuZ3RoIDwgNSkge1xyXG4gICAgICAgICAgICByZXR1cm4gR2FtZVJlc3VsdC5QTEFZSU5HO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgcm93cy5cclxuICAgICAgICAgICAgY29uc3Qgcm93cyA9IHVuaXF1ZSh0aGlzLmJvYXJkW2ldKTtcclxuICAgICAgICAgICAgaWYgKHJvd3MubGVuZ3RoID09PSAxICYmIHJvd3NbMF0gIT09IFBsYXllci5OT05FKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndpbm5lciA9IHRoaXMuZ2V0UGxheWVyTmFtZSh0aGlzLmJvYXJkW2ldWzBdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMud2lubmluZ1RpbGVzID0gW1tpLCAwXSwgW2ksIDFdLCBbaSwgMl1dO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lUmVzdWx0ID0gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gQ2hlY2sgY29sdW1ucy5cclxuICAgICAgICAgICAgY29uc3QgY29sdW1ucyA9IHVuaXF1ZShbdGhpcy5ib2FyZFswXVtpXSwgdGhpcy5ib2FyZFsxXVtpXSwgdGhpcy5ib2FyZFsyXVtpXV0pO1xyXG4gICAgICAgICAgICBpZiAoY29sdW1ucy5sZW5ndGggPT09IDEgJiYgY29sdW1uc1swXSAhPT0gUGxheWVyLk5PTkUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMud2lubmVyID0gdGhpcy5nZXRQbGF5ZXJOYW1lKHRoaXMuYm9hcmRbMF1baV0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy53aW5uaW5nVGlsZXMgPSBbWzAsIGldLCBbMSwgaV0sIFsyLCBpXV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVSZXN1bHQgPSBHYW1lUmVzdWx0LldJTjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBHYW1lUmVzdWx0LldJTjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgZGlhZ3MuXHJcbiAgICAgICAgY29uc3QgZGlhZzEgPSB1bmlxdWUoW3RoaXMuYm9hcmRbMF1bMF0sIHRoaXMuYm9hcmRbMV1bMV0sIHRoaXMuYm9hcmRbMl1bMl1dKTtcclxuICAgICAgICBpZiAoZGlhZzEubGVuZ3RoID09PSAxICYmIGRpYWcxWzBdICE9PSBQbGF5ZXIuTk9ORSkge1xyXG4gICAgICAgICAgICB0aGlzLndpbm5lciA9IHRoaXMuZ2V0UGxheWVyTmFtZSh0aGlzLmJvYXJkWzBdWzBdKTtcclxuICAgICAgICAgICAgdGhpcy53aW5uaW5nVGlsZXMgPSBbWzAsIDBdLCBbMSwgMV0sIFsyLCAyXV07XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZVJlc3VsdCA9IEdhbWVSZXN1bHQuV0lOO1xyXG4gICAgICAgICAgICByZXR1cm4gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkaWFnMiA9IHVuaXF1ZShbdGhpcy5ib2FyZFswXVsyXSwgdGhpcy5ib2FyZFsxXVsxXSwgdGhpcy5ib2FyZFsyXVswXV0pO1xyXG4gICAgICAgIGlmIChkaWFnMi5sZW5ndGggPT09IDEgJiYgZGlhZzJbMF0gIT09IFBsYXllci5OT05FKSB7XHJcbiAgICAgICAgICAgIHRoaXMud2lubmVyID0gdGhpcy5nZXRQbGF5ZXJOYW1lKHRoaXMuYm9hcmRbMF1bMl0pO1xyXG4gICAgICAgICAgICB0aGlzLndpbm5pbmdUaWxlcyA9IFtbMCwgMl0sIFsxLCAxXSwgWzIsIDBdXTtcclxuICAgICAgICAgICAgdGhpcy5nYW1lUmVzdWx0ID0gR2FtZVJlc3VsdC5XSU47XHJcbiAgICAgICAgICAgIHJldHVybiBHYW1lUmVzdWx0LldJTjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnJvdW5kTW92ZXNQZXJJbmRleC5sZW5ndGggPT09IDMgKiAzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZVJlc3VsdCA9IEdhbWVSZXN1bHQuRFJBVztcclxuICAgICAgICAgICAgcmV0dXJuIEdhbWVSZXN1bHQuRFJBVztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBHYW1lUmVzdWx0LlBMQVlJTkc7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRQbGF5ZXJOYW1lKHBsYXllcjogUGxheWVyKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gcGxheWVyID09PSBQbGF5ZXIuWCA/IFwiWFwiIDogXCJPXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICB0aGlzLmRyYXdDYW52YXMoKTtcclxuICAgICAgICB0aGlzLmRyYXdTdGFydEJ1dHRvbigpO1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZXNldCgpIHtcclxuICAgICAgICB0aGlzLndpbm5lciA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy53aW5uaW5nVGlsZXMgPSBbXTtcclxuICAgICAgICB0aGlzLnJvdW5kTW92ZXNQZXJJbmRleCA9IFtdO1xyXG4gICAgICAgIHRoaXMucm91bmRNb3Zlc1BlclBsYXllciA9IHtcclxuICAgICAgICAgICAgW1BsYXllci5YXTogW10sXHJcbiAgICAgICAgICAgIFtQbGF5ZXIuT106IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXIgPSBQbGF5ZXIuWDtcclxuICAgICAgICB0aGlzLmJvYXJkID0gW1xyXG4gICAgICAgICAgICBbMCwgMCwgMF0sXHJcbiAgICAgICAgICAgIFswLCAwLCAwXSxcclxuICAgICAgICAgICAgWzAsIDAsIDBdXHJcbiAgICAgICAgXTtcclxuICAgICAgICB0aGlzLmdhbWVSZXN1bHQgPSBHYW1lUmVzdWx0LlBMQVlJTkc7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlc2V0UmVuZGVyKCkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQW5ub3VuY2VtZW50cygpO1xyXG4gICAgICAgIHRoaXMuJGNhbnZhcy5xdWVyeVNlbGVjdG9yQWxsKFwiLmJveFwiKS5mb3JFYWNoKCgkYm94KSA9PiB7XHJcbiAgICAgICAgICAgICRib3guaW5uZXJUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgJGJveC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIlwiO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IEdhbWUgZnJvbSBcIi4vR2FtZVwiO1xyXG5cclxubmV3IEdhbWUoKS5zdGFydCgpOyIsIi8vIFJldHVybnMgb25seSB0aGUgdW5pcXVlIHZhbHVlcyBvZiBhbiBhcnJheS5cclxuLy8gZWcuIGlucHV0IFsxLDEsMV0gcmV0dXJucyBbMV1cclxuLy8gZWcuIGlucHV0IFsxLDIsMV0gcmV0dXJucyBbMSwyXVxyXG5leHBvcnQgZnVuY3Rpb24gdW5pcXVlKGFycjogbnVtYmVyW10pOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gYXJyLnJlZHVjZSgoYWNjOiBudW1iZXJbXSwgY3VycmVudFZhbHVlOiBudW1iZXIpID0+IHtcclxuICAgICAgICBpZiAoIWFjYy5pbmNsdWRlcyhjdXJyZW50VmFsdWUpKSB7IGFjYy5wdXNoKGN1cnJlbnRWYWx1ZSk7IH1cclxuICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgfSwgW10pO1xyXG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0aWYoX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSkge1xuXHRcdHJldHVybiBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZVxuX193ZWJwYWNrX3JlcXVpcmVfXyhcIi4vc3JjL2luZGV4LnRzXCIpO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgdXNlZCAnZXhwb3J0cycgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxuIl0sInNvdXJjZVJvb3QiOiIifQ==